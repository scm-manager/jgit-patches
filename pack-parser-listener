# HG changeset patch
# Parent  7233eabe9a3c4c2c9a758ae3817fada2c86504e3

diff -r 7233eabe9a3c org.eclipse.jgit/src/org/eclipse/jgit/transport/BaseReceivePack.java
--- a/org.eclipse.jgit/src/org/eclipse/jgit/transport/BaseReceivePack.java	Thu Jul 14 21:17:43 2016 +0200
+++ b/org.eclipse.jgit/src/org/eclipse/jgit/transport/BaseReceivePack.java	Thu Jul 14 21:20:41 2016 +0200
@@ -140,6 +140,37 @@
 			return capabilities;
 		}
 	}
+  
+  /** 
+   * PackParserListeners are notified before the {@link PackParser} starts 
+   * parsing the receive pack and after the parsing. The listener is needed to 
+   * get the information which objects are pushed with the receive pack. 
+   * Provided for SCM-Manager 1.45.
+   */
+  public static interface PackParserListener {
+    
+    /**
+     * This method is called before the 
+     * {@link PackParser#parse(ProgressMonitor, ProgressMonitor)} method is 
+     * called.
+     * 
+     * @param parser receive pack parser
+     */
+    public void before(PackParser parser);
+
+    /**
+     * This method is called after the 
+     * {@link PackParser#parse(ProgressMonitor, ProgressMonitor)} method was 
+     * called.
+     * 
+     * @param parser receive pack parser
+     */
+    public void after(PackParser parser);
+    
+  }
+  
+  /** listener for pack parser finish event */
+  private PackParserListener packParserListener;
 
 	/** Database we write the stored objects into. */
 	private final Repository db;
@@ -662,6 +693,11 @@
 	public RefFilter getRefFilter() {
 		return refFilter;
 	}
+  
+  /** @return PackParserListener */
+  public final PackParserListener getPackParserListener(){
+    return packParserListener;
+  }
 
 	/**
 	 * Set the hook used while advertising the refs to the client.
@@ -696,6 +732,14 @@
 	public void setRefFilter(final RefFilter refFilter) {
 		this.refFilter = refFilter != null ? refFilter : RefFilter.DEFAULT;
 	}
+  
+  /** Sets the listener for the {@link PackParser}.
+   * 
+   * @param packParserListener listener
+   */
+  public void setPackParserListener(PackParserListener packParserListener){
+    this.packParserListener = packParserListener;
+  }
 
 	/** @return timeout (in seconds) before aborting an IO operation. */
 	public int getTimeout() {
@@ -1228,9 +1272,20 @@
 			parser.setObjectChecker(objectChecker);
 			parser.setLockMessage(lockMsg);
 			parser.setMaxObjectSizeLimit(maxObjectSizeLimit);
+
+      // call listener before
+      if (packParserListener != null){
+        packParserListener.before(parser);
+      }
+
 			packLock = parser.parse(receiving, resolving);
 			packSize = Long.valueOf(parser.getPackSize());
 			ins.flush();
+
+      // call listener after
+      if (packParserListener != null){
+        packParserListener.after(parser);
+      }
 		}
 
 		if (timeoutIn != null)
